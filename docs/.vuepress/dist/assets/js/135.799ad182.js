(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{167:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),s("p",[t._v("Weex SDK 只提供渲染，提供了一些默认的组件和能力，如果你需要一些特性但 Weex 并未提供，可以通过扩展自定义的一些插件来实现，通过 WeexSDK 加载。")]),s("p",[t._v("本文都以 Objective-C 为例子书写，如果需要 swift 请参考 "),s("router-link",{attrs:{to:"/guide/extend-ios-with-swift.html"}},[t._v("使用 swift 扩展 Weex")]),t._v("。")],1),t._m(1),t._m(2),t._m(3),s("p",[t._v("下面完成一个 module, 该 module 暴露一个打印输入参数的方法：")]),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),s("p",[t._v("可能 WeexSDK 内置提供的组件并不能满足你的开发需求，比如需要期望使用地图这样一个复杂的组件，可以通过自定义一个组件，注册到 WeexSDK engine 中， 可以很方便的使用起来。")]),t._m(9),t._m(10),t._m(11),s("p",[t._v("native 的 component 是由 Weex 管理的，Weex 创建，布局，渲染，销毁。Weex 的 component 生命周期都是可以 hook 的，你可以在这些生命周期中去做自己的事情。")]),t._m(12),t._m(13),t._m(14),s("p",[t._v("WeexSDK 0.9.5 之后支持了在 js 中直接调用 component 的方法，自定义完组件后，下面的例子可以指引你完成 component 方法。")]),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19)])},[function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("blockquote",[s("p",[t._v("注意：Weex 所有暴露给 JS 的内置 module 或 component API 都是安全和可控的， 它们不会去访问系统的私有 API ，也不会去做任何 runtime 上的 hack 更不会去改变应用原有的功能定位。"),s("br"),t._v("\n如果需要扩展自定义的 module 或者 component ，一定注意不要将 OC 的 runtime 暴露给 JS ， 不要将一些诸如 "),s("code",[t._v("dlopen()")]),t._v("， "),s("code",[t._v("dlsym()")]),t._v("， "),s("code",[t._v("respondsToSelector:")]),t._v("，"),s("code",[t._v("performSelector:")]),t._v("，"),s("code",[t._v("method_exchangeImplementations()")]),t._v(" 的动态和不可控的方法暴露给JS， 也不要将系统的私有API暴露给JS")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"自定义-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义-module","aria-hidden":"true"}},[this._v("#")]),this._v(" 自定义 module")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("自定义 module, 需要让自己的 class 遵循 "),a("code",[this._v("WXModuleProtocol")]),this._v(" 这个protocol, 通过 "),a("code",[this._v("WX_EXPORT_METHOD")]),this._v(" 这个宏暴露出需要透出到 "),a("code",[this._v("JavaScript")]),this._v(" 调用的方法，注册 module , 就可以完成一个简单 module 的自定义。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"module-自定义初阶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module-自定义初阶","aria-hidden":"true"}},[this._v("#")]),this._v(" module 自定义初阶")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[t._v("新建一个 基类为 NSObject 的 class "),s("code",[t._v("WXCustomEventModule")]),t._v(", 让该类遵循 "),s("code",[t._v("WXModuleProtocol")]),t._v(" 的协议\n"),s("img",{attrs:{src:"https://img.alicdn.com/tfs/TB1LrZ8n7voK1RjSZPfXXXPKFXa-1042-264.png",width:"100%"}})]),s("li",[t._v("添加打印的方法，通过 "),s("code",[t._v("WX_EXPORT_METHOD")]),t._v(" 暴露该方法\n"),s("img",{attrs:{src:"https://img.alicdn.com/tfs/TB156M9nZfpK1RjSZFOXXa6nFXa-1434-564.png",width:"100%"}})]),s("li",[t._v("在初始化完成 Weex SDK 之后注册该 module\n"),s("img",{attrs:{src:"https://img.alicdn.com/tfs/TB1IGo4nVzqK1RjSZFoXXbfcXXa-1420-122.png",width:"100%"}}),t._v("\n到此，我们已经完成了一个简单的 module 方法的封装，javaScript 端的使用如下:")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("weex"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("requireModule")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"event"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("showParams")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"hello weex"')]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"module-高阶用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#module-高阶用法","aria-hidden":"true"}},[this._v("#")]),this._v(" module 高阶用法")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[s("code",[t._v("weexInstance")]),s("br"),t._v("\n在一个 Weex 页面中，默认 WXSDKInstance 的 Object 持有 多个 module 的 Object, 而 module 的 object 是没有对 WXSDKInstance 做持有的， 在自定义的module 中添加 "),s("code",[t._v("@synthesize weexInstance")]),t._v(", module Object 可以对 持有它本身的 WXSDKInstance Object 做一个 弱引用， 通过 weexInstance 可以拿到调用该 module 的页面的一些信息。")]),s("li",[s("code",[t._v("targetExecuteThread")]),s("br"),t._v("\nModule 方法默认会在UI线程中被调用，建议不要在这做太多耗时的任务，如果要在其他线程执行整个module 方法，需要实现"),s("code",[t._v("WXModuleProtocol")]),t._v(" 中 "),s("code",[t._v("- (NSThread *)")]),t._v(" 的方法，这样，分发到这个module的任务会在指定的线程中运行。")]),s("li",[s("code",[t._v("WXModuleKeepAliveCallback")]),s("br"),t._v("\nModule 支持返回值给 JavaScript中的回调，回调的类型是 "),s("code",[t._v("WXModuleKeepAliveCallback")]),t._v("，回调的参数可以是String或者Map, 该 block 第一个参数为回调给 JavaScript 的数据，第二参数是一个 BOOL 值，表示该回调执行完成之后是否要被清除，JavaScript 每次调用都会产生一个回调，但是对于单独一次调用，是否要在完成该调用之后清除掉回调函数 id 就由这个选项控制，如非特殊场景，建议传 NO。")]),s("li",[s("code",[t._v("WX_EXPORT_METHOD_SYNC")]),s("br"),t._v("\n使用 "),s("code",[t._v("WX_EXPORT_METHOD")]),t._v(" 暴露到前端的方法都是异步方法(获得结果需要通过回调函数获得), 如果期望获得同步调用结果，可以使用 "),s("code",[t._v("WX_EXPORT_METHOD_SYNC")]),t._v(" 暴露module 方法。")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"component-扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#component-扩展","aria-hidden":"true"}},[this._v("#")]),this._v(" Component 扩展")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"component-基础生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#component-基础生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" component 基础生命周期")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("新建一个基类为 "),s("code",[t._v("WXComponent")]),t._v(" 的 class"),s("br"),t._v("\n如果此时我们什么都不做，将改组件注册进 WeexSDK engine，它的功能就跟内置的 div 组件功能是一致的。")]),s("li",[t._v("覆盖 "),s("code",[t._v("WXComponent")]),t._v(" 中的生命周期方法\n"),s("ul",[s("li",[s("code",[t._v("loadView")]),s("br"),t._v("\n一个 component 默认对应于一个 view，如果未覆盖 "),s("code",[t._v("loadView")]),t._v(" 提供自定义 "),s("code",[t._v("view")]),t._v(", 会使用 "),s("code",[t._v("WXComponent")]),t._v(" 基类中的 "),s("code",[t._v("WXView")]),t._v(", "),s("code",[t._v("WXView")]),t._v(" 是继承自 UIView 的一个派生 view。要实现地图功能，我们需要对应的地图 view, 比如系统的 "),s("code",[t._v("MKMapView")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("- (UIView *)loadView {\n  return [MKMapView new];\n}\n")])])])]),s("li",[s("code",[t._v("viewDidLoad")]),t._v("\n对组件 view 需要做一些配置，比如设置 delegate, 可以在 "),s("code",[t._v("viewDidLoad")]),t._v(" 生命周期做，如果当前 view 没有添加 subview 的话，不要设置 view 的 frame，WeexSDK 会根据 style 设置。"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("- (void)viewDidLoad {\n  ((MKMapView*)self.view).delegate = self;\n} \n")])])])])])]),s("li",[t._v("注册 component"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('[WXSDKEngine registerComponent:@"map" withClass:[WXMapComponent class]];\n')])])]),t._v("在前端页面直接可以使用 "),s("code",[t._v("<map>")]),t._v(" 标签，如下所示"),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("map")]),s("span",{attrs:{class:"token style-attr language-css"}},[s("span",{attrs:{class:"token attr-name"}},[t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("style")])]),s("span",{attrs:{class:"token punctuation"}},[t._v('="')]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token property"}},[t._v("width")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200px"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{attrs:{class:"token property"}},[t._v("height")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200px")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("map")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])]),s("li",[t._v("支持自定义事件"),s("br"),t._v("\n给 map 组件支持 "),s("code",[t._v("mapLoaded")]),t._v(" 事件"),s("div",{staticClass:"language-vue extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vue"}},[s("code",[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("map")]),s("span",{attrs:{class:"token style-attr language-css"}},[s("span",{attrs:{class:"token attr-name"}},[t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("style")])]),s("span",{attrs:{class:"token punctuation"}},[t._v('="')]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token property"}},[t._v("width")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200px"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{attrs:{class:"token property"}},[t._v("height")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200px")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("@mapLoaded")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("onMapLoaded"),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("map")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token script language-javascript"}},[t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  methods"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    onMapLoaded"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v('"map loaded"')]),s("span",{attrs:{class:"token operator"}},[t._v("+")]),s("span",{attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("stringify")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),t._v("给当前组件添加 BOOL 成员 mapLoaded,记录当前事件是否被添加，当地图加载完成时候，我们可以根据这个判断是否应该发送事件。\n"),s("ul",[s("li",[t._v("覆盖组件生命周期方法添加和移除事件"),s("br"),t._v("\n覆盖 "),s("code",[t._v("addEvent")]),t._v(" 和 "),s("code",[t._v("removeEvent")]),t._v(" 方法"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('- (void)addEvent:(NSString *)eventName {\n  if ([eventName isEqualToString:@"mapLoaded"]) {\n    _mapLoaded = YES;\n  }\n}\n\n- (void)removeEvent:(NSString *)eventName\n{\n  if ([eventName isEqualToString:@"mapLoaded"]) {\n    _mapLoaded = NO;\n  }\n}\n')])])]),s("ul",[s("li",[t._v("在适宜的时间发事件通知\n在 MKMapView 加载完成的 delegate 方法中，发事件通知自定义事件")])]),s("blockquote",[s("p",[t._v("不要忘记设置 MKMapView 的 delegate.")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('- (void)mapViewDidFinishLoadingMap:(MKMapView *)mapView {\n  if (_mapLoaded) {\n    [self fireEvent:@"mapLoaded" params:@{@"customKey":@"customValue"} domChanges:nil]\n  }\n}\n')])])])])])]),s("li",[t._v("支持自定义属性"),s("br"),t._v("\n添加自定义属性 "),s("code",[t._v("showTraffic")]),s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("map")]),s("span",{attrs:{class:"token style-attr language-css"}},[s("span",{attrs:{class:"token attr-name"}},[t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("style")])]),s("span",{attrs:{class:"token punctuation"}},[t._v('="')]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token property"}},[t._v("width")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200px"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{attrs:{class:"token property"}},[t._v("height")]),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("200px")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("showTraffic")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("map")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("ul",[s("li",[s("p",[t._v("覆盖组件初始化方法 "),s("code",[t._v("initWithRef...")])]),s("p",[t._v("当前component 添加 "),s("code",[t._v("BOOL")]),t._v(" 成员 showsTraffic，接受保存用户输入值，添加到当前组件上的所有属性都会在初始化方法中 "),s("code",[t._v("attributes")]),t._v(" 中传过来，此处我们处理我们感兴趣的属性即可。")]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('- (instancetype)initWithRef:(NSString *)ref type:(NSString *)type styles:(NSDictionary *)styles attributes:(NSDictionary *)attributes events:(NSArray *)events weexInstance:(WXSDKInstance *)weexInstance {\n  if(self = [super initWithRef:ref type:type styles:styles attributes:attributes events:events weexInstance:weexInstance]) {\n    if (attributes[@"showsTraffic"]) {\n      _showsTraffic = [WXConvert BOOL: attributes[@"showsTraffic"]];\n    }\n  }\n  return self;\n}\n')])])]),s("ul",[s("li",[t._v("在 "),s("code",[t._v("viewDidLoad")]),t._v(" 中设置该属性"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("- (void)viewDidLoad {\n  ((MKMapView*)self.view).showsTraffic = _showsTraffic;\n}\n")])])])]),s("li",[t._v("支持属性更新"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('- (void)updateAttributes:(NSDictionary *)attributes{\n  if (attributes[@"showsTraffic"]) {\n    _showsTraffic = [WXConvert BOOL: attributes[@"showsTraffic"]];\n    ((MKMapView*)self.view).showsTraffic = _showsTraffic;\n  }\n}\n')])])])])])])])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"更多-component-生命周期"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多-component-生命周期","aria-hidden":"true"}},[this._v("#")]),this._v(" 更多 component 生命周期")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("table",[s("thead",[s("tr",[s("th",[t._v("方法")]),s("th",[t._v("描述")])])]),s("tbody",[s("tr",[s("td",[t._v("initWithRef:type:…")]),s("td",[t._v("用给定的属性初始化一个component.")])]),s("tr",[s("td",[t._v("layoutDidFinish")]),s("td",[t._v("在component完成布局时候会调用.")])]),s("tr",[s("td",[t._v("loadView")]),s("td",[t._v("创建component管理的view.")])]),s("tr",[s("td",[t._v("viewWillLoad")]),s("td",[t._v("在component的view加载之前会调用.")])]),s("tr",[s("td",[t._v("viewDidLoad")]),s("td",[t._v("在component的view加载完之后调用.")])]),s("tr",[s("td",[t._v("viewWillUnload")]),s("td",[t._v("在component的view被释放之前调用.")])]),s("tr",[s("td",[t._v("viewDidUnload")]),s("td",[t._v("在component的view被释放之后调用.")])]),s("tr",[s("td",[t._v("updateStyles:")]),s("td",[t._v("在component的style更新时候调用.")])]),s("tr",[s("td",[t._v("updateAttributes:")]),s("td",[t._v("在component的attribute更新时候调用.")])]),s("tr",[s("td",[t._v("addEvent:")]),s("td",[t._v("给component添加event的时候调用.")])]),s("tr",[s("td",[t._v("removeEvent:")]),s("td",[t._v("在event移除的时候调用.")])])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("或许你需要考虑更多的生命周期方法去 Hook，当布局完成时候，像 "),a("code",[this._v("layoutDidFinish")]),this._v("，如果你想了解更多，可以参考一下 "),a("code",[this._v("WXComponent.h")]),this._v(" 声明的方法。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"component-方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#component-方法","aria-hidden":"true"}},[this._v("#")]),this._v(" component 方法")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("自定义一个 WXMyCompoenent 的组件"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('@implementation WXMyComponent\nWX_EXPORT_METHOD(@selector(focus)) // 暴露该方法给js\n- (instancetype)initWithRef:(NSString *)ref type:(NSString *)type styles:(NSDictionary *)styles attributes:(NSDictionary *)attributes events:(NSArray *)events weexInstance:(WXSDKInstance *)weexInstance {\n  if (self = [super initWithRef:ref type:type styles:styles attributes:attributes events:events weexInstance:weexInstance]) {\n    // handle your attributes\n    // handle your styles\n  }\n  return self;\n}\n\n- (void)focus {\n  NSLog(@"you got it");\n}\n@end\n')])])])]),s("li",[t._v("注册组件 "),s("code",[t._v('[WXSDKEngine registerComponent:@"mycomponent" withClass:[WXMyComponent class]]')])]),s("li",[t._v("在 weex 文件中调用"),s("div",{staticClass:"language-vue extra-class"},[s("pre",{pre:!0,attrs:{class:"language-vue"}},[s("code",[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("mycomponent")]),t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("ref")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v("'")]),t._v("mycomponent"),s("span",{attrs:{class:"token punctuation"}},[t._v("'")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("mycomponent")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("template")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{attrs:{class:"token script language-javascript"}},[t._v("\n  module"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    created"),s("span",{attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{attrs:{class:"token keyword"}},[t._v("function")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{attrs:{class:"token keyword"}},[t._v("this")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$refs"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mycomponent"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("focus")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")]),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"自定义-handler"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义-handler","aria-hidden":"true"}},[this._v("#")]),this._v(" 自定义 handler")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("weexSDK 目前没有提供图片下载的能力，在 "),a("code",[this._v("WXImgLoaderProtocol")]),this._v(" 定义了一些获取图片的接口, image 组件正是通过 "),a("code",[this._v("WXImgLoaderProtocol")]),this._v(" 获得并展示图片，开发者可以实现该 protocol 中的接口方法，这样 "),a("code",[this._v("image")]),this._v(" 标签才能正常展示图片。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("开发者也可以定义自己的 "),a("code",[this._v("protocol")]),this._v(" 和对应的实现来使用 "),a("code",[this._v("handler")]),this._v(" 机制。")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("新建基类为 NSObject 的 class 实现 "),s("code",[t._v("WXImgLoaderProtocol")]),t._v(" 协议， 实现 "),s("code",[t._v("WXImgLoaderProtocol")]),t._v(" 的方法\n"),s("blockquote",[s("p",[t._v("下面加载图片的逻辑需要依赖 SDWebImage，你也可以不依赖 SDWebimage 使用自己的方式加载对应 URL 图片。")])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('@implementation WXImgLoaderDefaultImpl\n- (id<WXImageOperationProtocol>)downloadImageWithURL:(NSString *)url imageFrame:(CGRect)imageFrame userInfo:(NSDictionary *)userInfo completed:(void(^)(UIImage *image,  NSError *error, BOOL finished))completedBlock\n{\n    if ([url hasPrefix:@"//"]) {\n        url = [@"http:" stringByAppendingString:url];\n    }\n    return (id<WXImageOperationProtocol>)[[SDWebImageManager sharedManager] downloadImageWithURL:[NSURL URLWithString:url] options:0 progress:^(NSInteger receivedSize, NSInteger expectedSize) {\n    } completed:^(UIImage *image, NSError *error, SDImageCacheType cacheType, BOOL finished, NSURL *imageURL) {\n    if (completedBlock) {\n        completedBlock(image, error, finished);\n    }\n    }];\n}\n@end\n')])])])]),s("li",[t._v("注册 handler\n你可以通过WXSDKEngine 中的 "),s("code",[t._v("registerHandler:withProtocol")]),t._v(" 注册handler"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("WXSDKEngine.h\n/**\n* @abstract Registers a handler for a given handler instance and specific protocol\n* @param handler The handler instance to register\n* @param protocol The protocol to confirm\n*/\n+ (void)registerHandler:(id)handler withProtocol:(Protocol *)protocol;\n\n[WXSDKEngine registerHandler:[WXImgLoaderDefaultImpl new] withProtocol:@protocol(WXImgLoaderProtocol)]\n\n")])])])]),s("li",[t._v("使用 handler\nhandler 可以在 native 的 module 或者 component 实现中使用"),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("id<WXImgLoaderProtocol> imageLoader = [WXSDKEngine handlerForProtocol:@protocol(WXImgLoaderProtocol)];\n[iamgeLoader downloadImageWithURL:imageURl imageFrame:frame userInfo:customParam completed:^(UIImage *image, NSError *error, BOOL finished){\n}];\n\n")])])])])])}],!1,null,null,null);e.options.__file="extend-ios.md";a.default=e.exports}}]);